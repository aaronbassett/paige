# Phase 3 Retrospective: User Story 1 — Server Foundation & Lifecycle

## What Worked Well
- TDD approach: writing contract + integration tests first clearly specified the expected server behavior
- Parallel agent execution for test files (contract + integration tests simultaneously)
- Port 0 pattern for OS-assigned ports eliminates test flakiness from port conflicts
- Combined T062-T067 into a single implementation pass since they all touch `src/index.ts`

## What Didn't Work
- ESLint type-checked rules applied to `vitest.config.ts` which is outside the project service scope
- lint-staged ESLint `--no-warn-ignored` flag needed because staged ignored files generate warnings with `--max-warnings=0`
- Prettier format glob (`src/**/*.ts tests/**/*.ts`) doesn't cover root-level `.ts` config files

## Workarounds & Solutions
- **ESLint + vitest.config.ts**: Added `"*.config.ts"` to ESLint global ignores in `eslint.config.js`
- **lint-staged warn-ignored**: Added `--no-warn-ignored` to the ESLint command in `package.json` lint-staged config
- **Prettier root configs**: Run `npx prettier --write vitest.config.ts` directly (pnpm format glob misses root files)
- **TDD stub pattern**: Create interface + throwing async function stub so tests compile but fail at runtime

## Packages & Dependencies
- No new dependencies needed for Phase 3
- Native `http` module + `fetch` (Node 18+ global) sufficient for server + tests

## Patterns & Code
- **createServer pattern**: Returns `{ server, close }` handle for lifecycle management
- **Promise-wrapped server.listen**: One-time error listener + callback → clean async/await
- **Health endpoint**: Simple `Date.now()` delta for uptime (adequate for seconds-resolution)
- **Request handler**: Switch on method + URL path, default to 404 JSON

## For Next Time
- Include `"*.config.ts"` in pnpm format script glob or use a broader pattern
- When modifying vitest.config.ts, always format it explicitly before committing
- Consider combining multiple small tasks that touch the same file into one agent pass
