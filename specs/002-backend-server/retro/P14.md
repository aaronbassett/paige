# Phase 14 Retrospective: User Story 12 — Dashboard Data Assembly

## What Worked Well
- Concurrent subagent execution for parallel tasks (test writing, flow implementations) significantly reduced total time
- TDD stubs created before tests allowed ESLint import resolution without implementation
- Existing codebase patterns (mock patterns, query patterns, handler patterns) made new code predictable
- Progressive flow architecture cleanly separates concerns — each flow is independently testable

## What Didn't Work
- Test expected `broadcast.toHaveBeenCalledTimes(1)` but handler broadcasts multiple times (state + issues + challenges) — had to fix to check first call instead
- `expect.any(Array/Number/Boolean)` triggers ESLint `no-unsafe-assignment` warnings — required explicit type assertions on mock.calls

## Workarounds & Solutions
- **Broadcast count in tests**: Use `mockBroadcast.mock.calls[0]![0] as { type: string; data: ... }` instead of `toHaveBeenCalledTimes(1)` when handler makes multiple broadcasts
- **Kysely join type widening**: Use `Number()` and `String()` wrappers on join query results where column types are broader than expected
- **JSON.parse ESLint**: Use `const raw: unknown = JSON.parse(str); const typed = raw as SpecificType;` to satisfy no-unsafe-assignment

## Packages & Dependencies
- No new dependencies needed — all functionality built with existing stack
- `node:child_process` execSync used for `gh` CLI integration (already available in Node.js)

## Patterns & Code
- **Progressive flow pattern**: Handler broadcasts Flow 1 synchronously, then runs Flows 2-4 concurrently via `Promise.all` with independent try/catch per flow
- **Period-filtered SQL queries**: Helper converts period string to SQLite datetime interval, conditionally adds WHERE clause
- **Static resource mapping (MVP)**: Knowledge gap topics matched to curated URLs via bidirectional substring matching instead of real web search
- **Kysely cross-table join for challenges**: `innerJoin('knowledge_gaps', 'knowledge_gaps.id', 'kata_specs.gap_id')` avoids N+1 query pattern

## For Next Time
- Consider extracting the period-to-interval conversion into a shared utility if more queries need period filtering
- Static learning resource map could be externalized to a JSON file for easier maintenance
